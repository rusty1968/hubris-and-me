# I²C Topology Glossary

## Core I²C Terms

**I²C (Inter-Integrated Circuit)**  
Two-wire serial protocol using SCL (clock) and SDA (data) lines. Supports multiple devices on a single bus with 7-bit or 10-bit addressing.

**SCL (Serial Clock Line)**  
Clock signal generated by the master/initiator. All devices on the segment see the same clock.

**SDA (Serial Data Line)**  
Bidirectional data line. Both master and slave can drive it low (open-drain).

**Master/Initiator**  
Device that starts transactions, provides clock, and controls bus direction. Modern specs prefer "initiator."

**Slave/Target**  
Device that responds to master. Address is fixed or configurable. Modern specs prefer "target."

**7-bit Address**  
Standard I²C addressing (0x00-0x7F). Actual bits on wire include R/W bit, making 8 bits total.

**Pull-up Resistors**  
Required resistors (typically 2.2k-10k) pulling SCL/SDA high. Only one set per electrical segment.

## Topology Components

**Controller**  
Physical I²C peripheral in the SoC/MCU (e.g., I2C0, I2C1). Independent hardware block with registers.

**Port**  
Alternative pin mapping for a controller. Some controllers can use different GPIO pins (e.g., I2C2 on PA8/PA9 or PB10/PB11).

**Segment**  
Electrically continuous portion of I²C bus. All devices on a segment see all traffic. Limited by capacitance (~400pF).

**Root Segment**  
The segment directly connected to the I²C controller, before any muxes or switches.

**Mux (Multiplexer)**  
I²C-controlled switch connecting upstream to one-of-N downstream segments. Has its own I²C address (e.g., PCA9548A).

**Channel**  
One downstream path of a mux. Terms "channel," "port," and "segment" often used interchangeably for mux outputs.

**Bus**  
Can mean: (1) the entire I²C network from a controller, (2) a single segment, or (3) the protocol itself.

## Electrical Terms

**Capacitance**  
Total capacitive load on segment. Each device adds ~10pF, PCB traces ~2pF/cm. Max ~400pF for standard mode.

**Rise Time**  
Time for signal to go from 30% to 70% of VDD. Limited by pull-up strength and bus capacitance.

**Clock Stretching**  
Slave holding SCL low to slow down master. Not all devices/controllers support this.

**Open-Drain**  
Output type where transistor can only pull low. High state comes from pull-up resistor.

## Protocol Terms

**START Condition**  
SDA falls while SCL is high. Signals beginning of transaction.

**STOP Condition**  
SDA rises while SCL is high. Signals end of transaction.

**Repeated START**  
START without preceding STOP. Used for combined write-then-read operations.

**ACK/NACK**  
Acknowledge (SDA low) or Not-Acknowledge (SDA high) during 9th clock pulse.

**Write-Read Transaction**  
Write register address, then repeated START and read data. Common pattern for register access.

## Address Terms

**Reserved Addresses**  
0x00-0x07 and 0x78-0x7F are reserved by I²C spec for special purposes.

**General Call (0x00)**  
Broadcast address that all devices (that support it) respond to.

**10-bit Address**  
Extended addressing using 0x78-0x7B prefix. Rarely used in practice.

**SMBus Address**  
7-bit address following SMBus rules (some addresses reserved for specific device types).

## Advanced Components

**Switch**  
Like a mux but typically 1:2 or bidirectional. May not provide full isolation.

**Buffer/Repeater**  
Active device that regenerates I²C signals. Allows longer buses or more devices.

**Level Shifter**  
Translates between voltage domains (e.g., 1.8V ↔ 3.3V). May be passive or active.

**Isolator**  
Galvanic isolation using optical or magnetic coupling. Adds latency but provides protection.

## Software Terms

**Lease**  
Software lock/reservation of I²C bus or segment to prevent concurrent access.

**In-band Management**  
Controlling mux selection via I²C commands to the mux itself (vs dedicated select pins).

**Bus Recovery**  
Sequence of clock pulses to unstick a confused device holding SDA low.

**Enumeration**  
Scanning bus to discover which addresses have responding devices.

## Error Conditions

**Bus Locked**  
Device holding SDA low indefinitely, preventing all communication.

**Arbitration Lost**  
Multi-master scenario where one master loses bus control.

**Clock Sync Failure**  
Multi-master scenario where clock synchronization fails.

**Spurious STOP/START**  
Noise or timing violation causing false bus conditions.

## Hubris/Oxide Specific

**Controller Enum**  
Type-safe representation of physical I²C peripheral (I2C0..I2C7).

**Mux Enum (M1-M5)**  
Logical identifier for muxes, decoupled from their I²C addresses.

**Segment Enum (S1-S16)**  
Logical identifier for mux channels/segments.

**ResponseCode**  
Detailed error types for better diagnostics (vs generic "I2C error").

**Mock Controller**  
Software I²C implementation for testing without hardware.


Looking at the Hubeis I2C device type system, here's the topology it supports:

```
┌─────────────────────────────────────────────────────────────────────┐
│                        I2C Topology Model                           │
└─────────────────────────────────────────────────────────────────────┘

Controller Layer (Physical I2C peripherals)
═══════════════════════════════════════════
    I2C0   I2C1   I2C2   I2C3   I2C4   I2C5   I2C6   I2C7   Mock
     │      │      │      │      │      │      │      │       │
     ▼      ▼      ▼      ▼      ▼      ▼      ▼      ▼       ▼

Port Layer (Optional - for controllers with multiple pin options)
═════════════════════════════════════════════════════════════════
     │
     ├─[Port 0]──┐
     ├─[Port 1]──┤  (Only one port active at a time)
     └─[Port N]──┘
            │
            ▼

Root Segment (Direct devices + Muxes)
══════════════════════════════════════
            │
     ┌──────┴──────┬─────────┬──────────┬─────────┐
     │             │         │          │         │
  Device@0x50   Device@0x68  Mux.M1    Mux.M2   Mux.M3
                             @0x70     @0x71    @0x72
                               │         │        │
                               ▼         ▼        ▼

Mux Layer (Up to 5 muxes: M1-M5 per controller)
════════════════════════════════════════════════
                               │
                    ┌──────────┴──────────┐
                    │    Mux.M1 @ 0x70    │
                    └─────────────────────┘
                               │
        ┌──────┬───────┬───────┼───────┬───────┬──────┐
        │      │       │       │       │       │      │
       S1     S2      S3      S4      S5     ...    S16
        │      │       │       │       │             │
        ▼      ▼       ▼       ▼       ▼             ▼

Segment Layer (Up to 16 segments: S1-S16 per mux)
══════════════════════════════════════════════════
        │
   ┌────┴────┬──────────┬──────────┐
   │         │          │          │
Device@0x50 Device@0x51 Device@0x68 ...


Full Path Examples:
═══════════════════
1. Direct device (no mux):
   Controller.I2C2 → [Port] → Device@0x50

2. Device behind single mux:
   Controller.I2C2 → [Port] → Mux.M1 → Segment.S3 → Device@0x68

3. Multiple muxes on same controller:
   Controller.I2C2 → [Port] → ├─ Mux.M1 → S1..S16 → Devices
                              ├─ Mux.M2 → S1..S16 → Devices
                              └─ Mux.M3 → S1..S16 → Devices
```

**Key topology constraints from the types:**

1. **Controllers**: 8 physical I2C controllers (I2C0-I2C7) + Mock for testing

2. **Ports**: Optional layer - some controllers can switch between different pin sets (e.g., I2C2 on pins PA8/PA9 vs PB10/PB11)

3. **Muxes**: Up to 5 muxes (M1-M5) can exist per controller
   - Each mux has its own I2C address on the root segment
   - Muxes are identified by enum, not address (abstraction layer)

4. **Segments**: Up to 16 segments (S1-S16) per mux
   - Each segment is an isolated I2C bus
   - Only one segment active at a time (typical mux behavior)

5. **Addressing**: 
   - Reserved addresses are blocked (0x00-0x07, 0x78-0x7F)
   - Standard 7-bit addressing (no 10-bit support shown)

**What this topology does NOT support:**
- Cascaded muxes (mux behind another mux)
- Multi-level switching beyond single mux layer
- Switches (2:1 or N:1 without full isolation)
- I2C buffers/repeaters as distinct entities

**Typical usage pattern:**
```rust
// Direct device
i2c.write_read(Controller::I2C2, None, 0x50, &[reg], &mut buf)?;

// Device behind mux
i2c.write_read(Controller::I2C2, Some((Mux::M1, Segment::S3)), 0x68, &[reg], &mut buf)?;
```

This is a pragmatic model that covers most server/embedded topologies while avoiding the complexity of arbitrary tree structures.
